<!DOCTYPE html>
<html>
<head>
	<link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="jquery.js"></script>
</head>
<body>

<!-- 
	<button onclick="settimer()"> timer </button>
	<button onclick="hidetimer()"> hide </button> -->

	<div class="container">

		<div id="item-a"> Schedule 
			
			<div class="period" id="a"> A period </div>
			<div class="period" id="c"> A period </div>
			<div class="period" id="brunch"> A period </div>
			<div class="period" id="flex"> A period </div>
			<div class="period" id="lunch"> A period </div>
			<div class="period" id="b"> A period </div>
			<div class="period" id="g"> A period </div>

		</div>

		<div id="item-b"> Current Time 
			<div id="clock"> 00:00 </div>
		</div>

		<div id="item-c"> News 
			<div id="news-content"> 
				Do not touch the display. Thanks
			</div>
		</div>

	</div>


	<div id="countdown-content">
		<div id="countdowntext"> GO TO CLASS </div>
		<div id="countdown">  </div>
	</div>


	<script>
		var starttime;
		var currenttime = Date.now();
		var countdown = 60;
		var check = true;
		var hidden = true;
		var date = new Date();
		var periodtimes = [];
		var timer;

		var schedule;

		function settimer(){
			document.getElementById("countdowntext").style.display = 'block';
			document.body.style.background = "#ff0000";
			starttime = Date.now();
			var timer = setInterval(function(){
				updatetime();
    			if (currenttime - starttime >= 75000) {
    				console.log(currenttime + " " + starttime + " " + (currenttime-starttime));
    				clearInterval(timer);
    				hidetimer();
    				hidecontent();
        			return;
    			}
    		}, 13);
			// for (var i = periodtimes.length - 1; i >= 0; i--) {
			// 	if(date.getHour()=periodtimes[i].getHour() && date.getMinute()=periodtimes[i].getMinute()-1)
			// 		timer = setInterval(updatetime, 13);
			// }
		}

		function updatetime(){
			// if(countdown < 10) document.getElementById("countdown").style.setProperty("left", 25%);
			currenttime = Date.now();
			if(countdown > 0){
				countdown = parseFloat(Math.round(60000-(currenttime-starttime))/1000).toFixed(2);
				document.getElementById("countdown").innerHTML = countdown;
				console.log(countdown);
			}
			else {
				countdown = 0;
				document.getElementById("countdown").innerHTML = "0.00";
				document.getElementById("countdowntext").innerHTML = "you are late";
				console.log("set0");
			}
		}

		function hidetimer(){
			if(hidden) {
				document.getElementById("countdown-content").style.display = 'block';
				document.getElementById("countdowntext").style.display = 'block';
				document.body.style.background = "#ffffff";
				console.log(1);
			}
			else {
				document.getElementById("countdown-content").style.display = 'none';
				document.getElementById("countdowntext").style.display = 'none';
			}
			hidden = !hidden;
		}

		function hidecontent(){
			var elements = document.getElementsByClassName("container");
			if(hidden) {
			    for (var i = 0; i < elements.length; i++) {
			        elements[i].style.display = 'block';
			    }
				console.log("show");
			}
			else {
				for (var i = 0; i < elements.length; i++) {
			        elements[i].style.display = 'none';
			    }
				console.log("hide");
			}
		}

		function parseschedule(res){
			schedule = res.split(/\r?\n/);
			console.log(schedule);
		}

		function addperiod(periodname){
			var div = document.createElement('div');
			div.setAttribute('class', 'period');
			document.getElementById("item-a").append(div);
		}

		function updateclock(){
			// console.log("clock");
			date = new Date();
			if(date.getMinutes()>10) document.getElementById("clock").innerHTML = date.getHours()%12 + ":" + date.getMinutes();
			else document.getElementById("clock").innerHTML = date.getHours()%12 + ":0" + date.getMinutes();
			//checks if next 1 min before class & hidden
			if(countdowncheck(((date.getHours()%12)*100+date.getMinutes())+1)){
				// console.log(countdowncheck(((date.getHours()%12)*100+date.getMinutes())+1));
				if(hidden) {
					hidetimer();
					hidecontent();
					settimer();
				}
			}
		}

		//checks if time is at next period
		function countdowncheck(time){
			if(time==825 || time==945 || time==1155 || time==130){
				return true;
			}
			else return false;
		}

		$.get({
			url: "http://kvfrans.com:8044/schedule.txt",
			type: 'GET',
			success: function(res) {
				parseschedule(res);
			}
		});

		// setInterval(countdowncheck, 30)
		setInterval(updateclock, 13);

		// hidecontent();
		</script>

</body>
</html>
